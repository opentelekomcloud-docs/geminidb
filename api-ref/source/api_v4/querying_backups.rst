:original_name: nosql_12_0013.html

.. _nosql_12_0013:

Querying Backups
================

Function
--------

This API is used to query backups based on specified conditions.

URI
---

GET https://{Endpoint}/v4/{project_id}/backups

.. table:: **Table 1** URI parameter

   +------------+-----------+--------+----------------------------------------------------------------------------------------------------------------+
   | Parameter  | Mandatory | Type   | Description                                                                                                    |
   +============+===========+========+================================================================================================================+
   | project_id | Yes       | String | Project ID of a tenant in a region. To obtain this value, see :ref:`Obtaining a Project ID <nosql_projectid>`. |
   +------------+-----------+--------+----------------------------------------------------------------------------------------------------------------+

.. table:: **Table 2** Query parameters

   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter       | Mandatory       | Type            | Description                                                                                                                                                                                                                                                                                                                                                                                                  |
   +=================+=================+=================+==============================================================================================================================================================================================================================================================================================================================================================================================================+
   | instance_id     | No              | String          | Instance ID, which can be obtained by calling the API for querying instances. If no instance is available, call the API for creating an instance.                                                                                                                                                                                                                                                            |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | datastore_type  | No              | String          | Database type. The value can be:                                                                                                                                                                                                                                                                                                                                                                             |
   |                 |                 |                 |                                                                                                                                                                                                                                                                                                                                                                                                              |
   |                 |                 |                 | -  cassandra                                                                                                                                                                                                                                                                                                                                                                                                 |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | backup_id       | No              | String          | Backup ID                                                                                                                                                                                                                                                                                                                                                                                                    |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | backup_type     | No              | String          | Backup type, which is case sensitive. The value can be:                                                                                                                                                                                                                                                                                                                                                      |
   |                 |                 |                 |                                                                                                                                                                                                                                                                                                                                                                                                              |
   |                 |                 |                 | -  **Auto**: automated full backup                                                                                                                                                                                                                                                                                                                                                                           |
   |                 |                 |                 | -  **Manual**: manual full backup                                                                                                                                                                                                                                                                                                                                                                            |
   |                 |                 |                 | -  If this parameter is not transferred, all automated and manual backups (including database- and table-level backups) are queried by default.                                                                                                                                                                                                                                                              |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | type            | No              | String          | Backup policy type. The value can be:                                                                                                                                                                                                                                                                                                                                                                        |
   |                 |                 |                 |                                                                                                                                                                                                                                                                                                                                                                                                              |
   |                 |                 |                 | -  **Instance**: An instance backup is queried.                                                                                                                                                                                                                                                                                                                                                              |
   |                 |                 |                 | -  **DatabaseTable**: A database or table backup is queried.                                                                                                                                                                                                                                                                                                                                                 |
   |                 |                 |                 | -  The default value is **Instance**.                                                                                                                                                                                                                                                                                                                                                                        |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | limit           | No              | Integer         | Maximum backup records to be queried. The value ranges from **1** to **100**. If this parameter is not transferred, the first 100 instances are queried by default.                                                                                                                                                                                                                                          |
   |                 |                 |                 |                                                                                                                                                                                                                                                                                                                                                                                                              |
   |                 |                 |                 | Minimum value: **1**                                                                                                                                                                                                                                                                                                                                                                                         |
   |                 |                 |                 |                                                                                                                                                                                                                                                                                                                                                                                                              |
   |                 |                 |                 | Maximum value: **100**                                                                                                                                                                                                                                                                                                                                                                                       |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | offset          | No              | Integer         | Index position. The query starts from the next backup creation time indexed by this parameter under a specified project. If offset is set to *N*, the resource query starts from the *N*\ +1 piece of data. The value must be greater than or equal to **0**. If this parameter is not transferred, the index offset is **0** by default, indicating that the query starts from the latest created instance. |
   |                 |                 |                 |                                                                                                                                                                                                                                                                                                                                                                                                              |
   |                 |                 |                 | Minimum value: **0**                                                                                                                                                                                                                                                                                                                                                                                         |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | begin_time      | No              | String          | Start time of the backup query. The time point is in the *yyyy*\ **-**\ *mm*\ **-**\ *ddThh*\ **:**\ *mm*\ **:**\ *ssZ* format. **T** indicates the start time. **Z** indicates the time zone offset. The default value is left blank by default.                                                                                                                                                            |
   |                 |                 |                 |                                                                                                                                                                                                                                                                                                                                                                                                              |
   |                 |                 |                 | -  When **end_time** is not empty, **begin_time** is mandatory.                                                                                                                                                                                                                                                                                                                                              |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | end_time        | No              | String          | End time of the backup query. The time point is in the *yyyy*\ **-**\ *mm*\ **-**\ *ddThh*\ **:**\ *mm*\ **:**\ *ssZ* format. **T** indicates the start time. **Z** indicates the time zone offset. The default value is left blank by default.                                                                                                                                                              |
   |                 |                 |                 |                                                                                                                                                                                                                                                                                                                                                                                                              |
   |                 |                 |                 | -  When **begin_time** is not empty, **end_time** is mandatory.                                                                                                                                                                                                                                                                                                                                              |
   +-----------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Request Parameters
------------------

.. table:: **Table 3** Request header parameter

   ============ ========= ====== ===========
   Parameter    Mandatory Type   Description
   ============ ========= ====== ===========
   X-Auth-Token Yes       String User token
   ============ ========= ====== ===========

Response Parameters
-------------------

Status code: 200

.. table:: **Table 4** Response body parameters

   +-------------+------------------+--------------------------------------------------------------------------------------------------------------------+
   | Parameter   | Type             | Description                                                                                                        |
   +=============+==================+====================================================================================================================+
   | total_count | Integer          | Total backups                                                                                                      |
   +-------------+------------------+--------------------------------------------------------------------------------------------------------------------+
   | backups     | Array of objects | Backup details. For details, see :ref:`Table 5 <nosql_12_0013__en-us_topic_0000001580721473_table16331161315493>`. |
   +-------------+------------------+--------------------------------------------------------------------------------------------------------------------+

.. _nosql_12_0013__en-us_topic_0000001580721473_table16331161315493:

.. table:: **Table 5** Backup

   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Parameter             | Type                  | Description                                                                                                                                                                              |
   +=======================+=======================+==========================================================================================================================================================================================+
   | id                    | String                | Backup ID                                                                                                                                                                                |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | description           | String                | Backup description                                                                                                                                                                       |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | instance_id           | String                | ID of an instance that a backup is created for                                                                                                                                           |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | instance_name         | String                | Name of an instance that a backup is created for                                                                                                                                         |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | datastore             | object                | Database version. For details, see :ref:`Table 6 <nosql_12_0013__en-us_topic_0000001580721473_table2356151316492>`.                                                                      |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | name                  | String                | Backup name                                                                                                                                                                              |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | type                  | String                | -  **Auto**: automated full backup                                                                                                                                                       |
   |                       |                       | -  **Manual**: manual full backup                                                                                                                                                        |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | size                  | Double                | Backup size, in KB                                                                                                                                                                       |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | status                | String                | Backup status. The value can be:                                                                                                                                                         |
   |                       |                       |                                                                                                                                                                                          |
   |                       |                       | -  **BUILDING**: backup in progress                                                                                                                                                      |
   |                       |                       | -  **COMPLETED**: backup completed                                                                                                                                                       |
   |                       |                       | -  **FAILED**: backup failed                                                                                                                                                             |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | begin_time            | String                | Backup start time. The time point is in the *yyyy*\ **-**\ *mm*\ **-**\ *ddThh*\ **:**\ *mm*\ **:**\ *ssZ* format. **T** indicates the start time. **Z** indicates the time zone offset. |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | end_time              | String                | Backup end time. The time point is in the *yyyy*\ **-**\ *mm*\ **-**\ *ddThh*\ **:**\ *mm*\ **:**\ *ssZ* format. **T** indicates the start time. **Z** indicates the time zone offset.   |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | database_tables       | Array of objects      | Database and table information in a backup. For details, see :ref:`Table 7 <nosql_12_0013__en-us_topic_0000001580721473_table6359191374915>`.                                            |
   |                       |                       |                                                                                                                                                                                          |
   |                       |                       | -  Keep this parameter empty or ignore it when you query an instance backup.                                                                                                             |
   |                       |                       | -  Specify this parameter when you query a database or table backup (if any).                                                                                                            |
   +-----------------------+-----------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _nosql_12_0013__en-us_topic_0000001580721473_table2356151316492:

.. table:: **Table 6** Datastore

   ========= ====== ================
   Parameter Type   Description
   ========= ====== ================
   type      String Database type
   version   String Database version
   ========= ====== ================

.. _nosql_12_0013__en-us_topic_0000001580721473_table6359191374915:

.. table:: **Table 7** QueryDatabaseTableInfo

   +-----------------------+-----------------------+-------------------------------------------------------------+
   | Parameter             | Type                  | Description                                                 |
   +=======================+=======================+=============================================================+
   | database_name         | String                | Database name                                               |
   +-----------------------+-----------------------+-------------------------------------------------------------+
   | table_names           | Array of strings      | Table names                                                 |
   |                       |                       |                                                             |
   |                       |                       | -  If this parameter is empty, database names are queried.  |
   |                       |                       | -  If this parameter is not empty, table names are queried. |
   +-----------------------+-----------------------+-------------------------------------------------------------+

Example Request
---------------

-  URI example

   .. code-block:: text

      GET https://{Endpoint}/v4/
      054b61972980d4552f0bc00ac8d3f5cd/backups?instance_id=c0c9f155c7b7423a9d30f0175998b63bin01&offset=2&limit=2&begin_time=2019-05-27T03:38:51+0000&end_time=2019-05-28T03:38:51+0000&type=DatabaseTable

-  Example request body

   None

Example Response
----------------

Status code: 200

Success

.. code-block::

   {
     "total_count" : 4,
     "backups" : [ {
       "id" : "43e4feaab48f11e89039fa163ebaa7e4br01",
       "name" : "backup-test",
       "instance_id" : "43e4feaab48f11e89039fa163ebaa7e4br01",
       "instance_name" : "cluster-test",
       "datastore" : {
         "type" : "cassandra",
         "version" : "3.4"
       },
       "type" : "Auto",
       "begin_time" : "2019-05-27T03:38:51+0000",
       "end_time" : "2019-05-27T03:39:51+0000",
       "status" : "COMPLETED",
       "size" : 2803,
       "description" : "backup description",
       "database_tables" : [ {
         "database_name" : "DATABASE_X",
         "table_names" : [ "TABLE_A", "TABLE_B", "TABLE_C" ]
       }, {
         "database_name" : "DATABASE_Y",
         "table_names" : null
       } ]
     }, {
       "id" : "43e4feaab48f11e89039fa163ebaa7e4br02",
       "name" : "backup-test-2",
       "instance_id" : "43e4feaab48f11e89039fa163ebaa7e4br02",
       "instance_name" : "cluster-test",
       "datastore" : {
         "type" : "cassandra",
         "version" : "3.4"
       },
       "type" : "Manual",
       "begin_time" : "2019-05-27T03:38:51+0000",
       "end_time" : "2019-05-27T03:39:51+0000",
       "status" : "COMPLETED",
       "size" : 2803,
       "description" : "backup description",
       "database_tables" : [ {
         "database_name" : "DATABASE_X",
         "table_names" : [ "TABLE_A", "TABLE_B", "TABLE_C" ]
       }, {
         "database_name" : "DATABASE_Y",
         "table_names" : null
       } ]
     } ]
   }

Status Codes
------------

See :ref:`Status Codes <nosql_status_code>`.

Error Codes
-----------

See :ref:`Error Codes <nosql_error_code>`.
